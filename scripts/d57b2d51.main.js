"use strict";var trace=function(){for(var a=0;a<arguments.length;a++)console.log(arguments[a])},App=App||{url:"https://project-management-api.herokuapp.com"},Project=Project||{},Task=Task||{},Comment=Comment||{},Router=Backbone.Router.extend({routes:{home:"home",users:"users","users/:id":"user",projects:"projects","projects/:id":"project","new-project":"newProject","update-project":"updateProject",tasks:"tasks","tasks/:id":"task"},home:function(){$("#container").empty()},users:function(){$("#container").empty(),$(".jumbotron").hide(),$.ajax({url:App.url+"/users",type:"GET"}).done(function(a){var b=Handlebars.compile($("#usersTemplate").html());$("#container").html(b({users:a.users}))}).fail(function(a,b,c){trace(a,b,c)}).always(function(a){trace(a)})},user:function(a){trace("hello from the user backbone!",a),$("#container").empty(),$(".jumbotron").hide();var b=window.location.hash,c=b.lastIndexOf("/"),d=parseInt(b.substring(c+1,b.length));$.ajax({url:App.url+"/users/"+d,type:"GET"}).done(function(a){var b=Handlebars.compile($("#userTemplate").html());$("#container").html(b({user:a.user})),$("button#avatar-change").click(function(){$("div#sign-in-form-slide").is(":hidden")?($("div#avatar-form").slideDown("slow"),App.getAmazonKey()):$("div#sign-in-form-slide").hide()})}).fail(function(a,b,c){trace(a,b,c)}).always(function(a){trace(a)})},projects:function(){$("#container").empty(),$(".jumbotron").hide(),$.ajax({url:App.url+"/projects",type:"GET"}).done(function(a){var b=Handlebars.compile($("#projectsTemplate").html());$("#container").html(b({projects:a.projects}))}).fail(function(a,b,c){trace(a,b,c)}).always(function(a){trace(a)})},project:function(){$("#container").empty(),$(".jumbotron").hide();var a=window.location.hash,b=a.lastIndexOf("/"),c=parseInt(a.substring(b+1,a.length));$.ajax({url:App.url+"/projects/"+c,type:"GET"}).done(function(a){console.log("I'm getting the project params back here"),console.log(a);var b=Handlebars.compile($("#projectTemplate").html());$("#container").html(b({project:a.project})),$("#update-project").on("click",function(){App.updateProject()}),$("#delete-project").on("click",function(){var a=confirm("Do you want to delete this project?");a&&App.deleteProject()}),$("#show-members").on("click",function(){App.showMembers(c)}),$("#new-task").on("click",function(){Task.newTask()})}).fail(function(a,b,c){trace(a,b,c)}).always(function(a){trace(a)})},newProject:function(){$("#container").empty().load("partials/project-form.html",function(){var a=$("#project-form");a.on("submit",function(b){Project.newProcessForm(b,a,router)})})},task:function(){$("#container").empty(),$(".jumbotron").hide();var a=window.location.hash,b=a.lastIndexOf("/"),c=parseInt(a.substring(b+1,a.length));$.ajax({url:App.url+"/tasks/"+c,type:"GET"}).done(function(a){var b=Handlebars.compile($("#taskTemplate").html());$("#container").html(b({task:a.task})),$("#new-comment").on("click",function(){Comment.newComment()}),$("#update-task").on("click",function(){Task.updateTask(),trace("hi update button is active")}),$("#show-comment").on("click",function(){Comment.showComments(c)}),$(".delete-comment").on("click",function(){Comment.deleteComment(c),trace("hi show comment button is active <:o")}),$("#delete-task").on("click",function(){var a=confirm("Do you want to delete this task?");a&&Task.deleteTask()})}).fail(function(a,b,c){trace(a,b,c)}).always(function(a){trace(a)})}});Project.newProcessForm=function(a,b,c){a.preventDefault&&a.preventDefault();var d=$(b).find("input[name='proj-name']").val(),e=$(b).find("input[name='proj-description']").val(),f=$(b).find("input[name='proj-date']").val(),g=$(b).find("select[name='proj-privacy']").val(),h=localStorage.getItem("currentUser");Project.newPostParams(d,e,f,g,h,c)},Project.newPostParams=function(a,b,c,d,e,f){$.ajax({url:App.url+"/projects",type:"POST",data:{project:{name:a,description:b,due_date:c,privacy:d}},complete:function(a,b){trace(a,b,"complete project!!")},success:function(a,b,c){f.navigate("projects",{trigger:!0}),trace(a,b,c,"successful post!!")},error:function(a,b,c){trace(a,b,c)}}).done(function(a){trace(a,"posted project!!")}).fail(function(a,b,c){trace(a,b,c),f.navigate("projects",{trigger:!0})}).always(function(a){trace(a)})},Task.newTask=function(){$("#container").empty().load("partials/task-form.html",function(){var a=$("#task-form");a.on("submit",function(b){Task.newTaskForm(b,a,router)})})},Task.newTaskForm=function(a,b,c){a.preventDefault&&a.preventDefault();var d=$(b).find("input[name='task-name']").val(),e=$(b).find("input[name='task-date']").val(),f=$(b).find("select[name='task-status']").val(),g=$(b).find("select[name='task-priority']").val(),h=$(b).find("input[name='task-order']").val(),i=$(b).find("select[name='task-privacy']").val();Task.newTaskParams(d,e,f,g,h,i,c)},Task.newTaskParams=function(a,b,c,d,e,f,g){var h=window.location.hash,i=h.lastIndexOf("/"),j=parseInt(h.substring(i+1,h.length));$.ajax({url:App.url+"/projects/"+j+"/tasks",type:"POST",data:{task:{name:a,due_date:b,status:c,priority:d,order:e,privacy:f}},complete:function(a,b){trace(a,b,"complete task!!")},success:function(a,b,c){g.navigate("projects",{trigger:!0}),trace(a,b,c,"successful task!!")},error:function(a,b,c){trace(a,b,c)}}).done(function(a){trace(a,"posted task!!")}).fail(function(a,b,c){trace(a,b,c),g.navigate("projects",{trigger:!0})}).always(function(a){trace(a)})},Task.updateTask=function(){$("#container").empty().load("partials/task-form.html",function(){var a=$("#task-form");a.on("submit",function(b){Task.updateTaskForm(b,a)})})},Task.updateTaskForm=function(a,b){var c=window.location.hash,d=c.lastIndexOf("/"),e=parseInt(c.substring(d+1,c.length));a.preventDefault&&a.preventDefault();var f=$(b).find("input[name='task-name']").val(),g=$(b).find("input[name='task-date']").val(),h=$(b).find("select[name='task-status']").val(),i=($(b).find("select[name='task-priority']").val(),$(b).find("input[name='task-order']").val()),j=$(b).find("select[name='task-privacy']").val();Task.updateTaskParams(f,g,h,i,j,e)},Task.updateTaskParams=function(a,b,c,d,e,f,g){$.ajax({url:App.url+"/tasks/"+g,type:"PATCH",data:{task:{name:a,due_date:b,status:c,priority:d,order:e,privacy:f}},complete:function(a,b){trace(a,b,"complete task!!")},success:function(a,b,c){router.navigate("projects",{trigger:!0}),trace(a,b,c,"successful task!!")},error:function(a,b,c){trace(a,b,c)}}).done(function(a){trace(a,"posted task!!")}).fail(function(a,b,c){trace(a,b,c),router.navigate("projects",{trigger:!0})}).always(function(a){trace(a)})},Task.deleteTask=function(){$("#container").empty(),$(".jumbotron").hide();var a=window.location.hash,b=a.lastIndexOf("/"),c=parseInt(a.substring(b+1,a.length));$.ajax({url:App.url+"/tasks/"+c,type:"DELETE"}).done(function(a){trace(a),trace("deleted project"),window.location.href="/ProjectManagementApp/#/projects"}).fail(function(a,b,c){trace(a,b,c)})},Comment.newComment=function(){$("#container").empty().load("partials/comment-form.html",function(){var a=$("#comment-form");a.on("submit",function(b){Comment.newCommentForm(b,a,router)})})},Comment.newCommentForm=function(a,b,c){a.preventDefault&&a.preventDefault();var d=$(b).find("input[name='comment-body']").val();Comment.newCommentParams(d,c)},Comment.newCommentParams=function(a,b){var c=window.location.hash,d=c.lastIndexOf("/"),e=parseInt(c.substring(d+1,c.length)),f=parseInt(localStorage.getItem("currentUser"));$.ajax({url:App.url+"/tasks/"+e+"/comments",type:"POST",data:{comment:{body:a,user_id:f}},complete:function(a,b){trace(a,b,"complete comment!!")},success:function(a,c,d){b.navigate("projects",{trigger:!0}),trace(a,c,d,"successful comment!!")},error:function(a,b,c){trace(a,b,c)}}).done(function(a){trace(a,"posted comment!!")}).fail(function(a,c,d){trace(a,c,d),b.navigate("projects",{trigger:!0})}).always(function(a){trace(a)})},Comment.showComments=function(a){$.ajax({url:App.url+"/tasks/"+a+"/comments",type:"GET"}).done(function(a){trace(a,"showed comment!!")}).fail(function(a,b,c){trace(a,b,c),router.navigate("projects",{trigger:!0})}).always(function(a){trace(a)})},Comment.deleteComment=function(a){$("#container").empty(),$(".jumbotron").hide(),$.ajax({url:App.url+"/tasks/"+a,type:"DELETE"}).done(function(a){trace(a),trace("deleted project"),window.location.href="/ProjectManagementApp/#/projects"}).fail(function(a,b,c){trace(a,b,c)})},App.updateProject=function(){$("#container").empty().load("partials/project-form.html",function(){var a=$("#project-form");a.on("submit",function(b){Project.updateProcessForm(b,a)})})},Project.updateProcessForm=function(a,b){var c=window.location.hash,d=c.lastIndexOf("/"),e=parseInt(c.substring(d+1,c.length));a.preventDefault&&a.preventDefault();var f=$(b).find("input[name='proj-name']").val(),g=$(b).find("input[name='proj-description']").val(),h=$(b).find("input[name='proj-date']").val(),i=$(b).find("select[name='proj-privacy']").val(),j=localStorage.getItem("currentUser");Project.updatePostParams(f,g,h,i,j,e)},Project.updatePostParams=function(a,b,c,d,e,f){$.ajax({url:App.url+"/projects/"+f,type:"PATCH",data:{project:{name:a,description:b,due_date:c,privacy:d}},complete:function(a,b){trace(a,b,"complete post!!")},success:function(a,b,c){router.navigate("projects",{trigger:!0}),trace(a,b,c,"successful post!!")},error:function(a,b,c){trace(a,b,c)}}).done(function(a){trace(a,"posted project!!")}).fail(function(a,b,c){trace(a,b,c),router.navigate("projects",{trigger:!0})}).always(function(a){trace(a)})},App.deleteProject=function(){$("#container").empty(),$(".jumbotron").hide();var a=window.location.hash,b=a.lastIndexOf("/"),c=parseInt(a.substring(b+1,a.length));$.ajax({url:App.url+"/projects/"+c,type:"DELETE"}).done(function(a){trace(a),window.location.href="/ProjectManagementApp/#/projects"}).fail(function(a,b,d){trace(App.url+"/#/projects/"+c),trace(a,b,d)})},App.showMembers=function(a){var b=window.location.hash,c=b.lastIndexOf("/"),a=parseInt(b.substring(c+1,b.length));$.ajax({url:App.url+"/#/project_memberships/"+a,type:"GET"}).done(function(a){trace(a,"showed members!!");var b=Handlebars.compile($("#membershipTemplate").html());a.users.map(function(a){$("#membership2").append(b(a))})}).fail(function(a,b,c){trace(a,b,c)}).always(function(a){trace(a)})};var router=new Router;Backbone.history.start(),$(document).ready(function(){$("div#avatar-change").hide()});var authToken,UserApp=function(){var a,b=function(){authToken=localStorage.getItem("authToken"),a="https://project-management-api.herokuapp.com",f(),$("#sign-in-form").on("submit",e),$("#sign-up-form").on("submit",c),$("#signout").on("click",g)},c=function(b){return b.preventDefault(),$.ajax({url:a+"/users",type:"POST",data:{user:{username:$("#username").val(),title:$("#title").val(),email:$("#email").val(),password:$("#password").val()}}}).done(function(a){d(a)}).fail(function(a){console.log(a)}),!1},d=function(a){localStorage.setItem("authToken",a.token),localStorage.setItem("currentUser",a.id),$.ajax({url:App.url+"/users/"+a.id,type:"GET"}).done(function(a){var b=Handlebars.compile($("#userTemplate").html());$("#container").html(b({user:a})),$("button#avatar-change").click(function(){$("div#sign-in-form-slide").is(":hidden")?($("div#avatar-form").slideDown("slow"),App.getAmazonKey()):$("div#sign-in-form-slide").hide()})}).fail(function(a,b,c){trace(a,b,c)}).always(function(a){trace(a)}),window.location.href="/ProjectManagementApp/#/users/"+a.id},e=function(b){var c;return b.preventDefault(),c=$(this),$.ajax({url:a+"/users/sign_in",type:"POST",data:c.serialize()}).done(d).fail(function(a){console.log(a)}),!1},f=function(){$.ajaxPrefilter(function(a){a.headers={},a.headers.AUTHORIZATION="Token token="+localStorage.authToken})},g=function(a){a.preventDefault(),localStorage.removeItem("authToken"),authToken=void 0,location.reload(),window.location.href="/ProjectManagementApp/index.html"};return{run:b}}(),SignUp=function(){$("button#sign-up").click(function(){$("div#sign-in-form-slide").hide(),$("div#form-slide").is(":hidden")?$("div#form-slide").slideDown("slow"):$("div#form-slide").hide()})},SignIn=function(){$("button#sign-in").click(function(){$("div#form-slide").hide(),$("div#sign-in-form-slide").is(":hidden")?$("div#sign-in-form-slide").slideDown("slow"):$("div#sign-in-form-slide").hide()})};$(document).ready(function(){UserApp.run(),$("div#form-slide").hide(),$("div#sign-in-form-slide").hide(),SignUp(),SignIn()});var myAws,fileName,App=App||{};App.getAmazonKey=function(){var a="https://project-management-api.herokuapp.com";$.ajax({url:a+"/amazon/sign_key/image%2Fjpeg"}).done(function(a){myAws=a,App.buildFormData(a),App.sendImageToRails(a.key)})},App.buildFormData=function(a){fileName=a.key,$("form#avatar").append('<input type="hidden" name="key" value="'+a.key+'">'),$("form#avatar").append('<input type="hidden" name="AWSAccessKeyId" value="'+a.access_key+'">'),$("form#avatar").append('<input type="hidden" name="policy" value="'+a.policy+'">'),$("form#avatar").append('<input type="hidden" name="signature" value="'+a.signature+'">'),$("form#avatar").append('<input type="hidden" name="Content-Type" value="image/jpeg">'),$("form#avatar").append("File to upload to S3"),$("form#avatar").append('<input id="file_upload" name="file" type="file"><br>'),$("form#avatar").append('<input id="form-submit" type="submit" value="Upload File to S3">')},App.sendImageToRails=function(a){var b=$("form#avatar");$("body").on("submit",b,function(b,c){App.postImageToRails(a),$(c).submit()})},App.postImageToRails=function(a){var b=window.location.hash,c=b.lastIndexOf("/"),d=parseInt(b.substring(c+1,b.length));$.ajax({url:"https://project-management-api.herokuapp.com/users/"+d,type:"PATCH",data:{user:{avatar:"https://s3.amazonaws.com/project-management-bucket/"+a}}}).done(function(a){App.avatarSuccess(a)}).fail(function(a,b,c){console.log(a,b,c)}).always(function(a){console.log(a)})},App.avatarSuccess=function(){console.log("avatar changes!")},$("button#task-file").on("click",function(){console.log("im in the task file")});